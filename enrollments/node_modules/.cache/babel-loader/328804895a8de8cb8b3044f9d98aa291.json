{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar getTimeParts_1 = __importDefault(require(\"../helpers/getTimeParts\"));\n\nvar now_1 = __importDefault(require(\"../helpers/now\"));\n\nvar TimerState_1 = __importDefault(require(\"./TimerState\"));\n\nvar TimerModel =\n/** @class */\nfunction () {\n  function TimerModel(_a) {\n    var initialTime = _a.initialTime,\n        direction = _a.direction,\n        timeToUpdate = _a.timeToUpdate,\n        lastUnit = _a.lastUnit,\n        checkpoints = _a.checkpoints,\n        onChange = _a.onChange;\n    this.internalTime = now_1.default();\n    this.initialTime = initialTime;\n    this.time = initialTime;\n    this.direction = direction;\n    this.timeToUpdate = timeToUpdate;\n    this.lastUnit = lastUnit;\n    this.checkpoints = checkpoints;\n    this.innerState = new TimerState_1.default(onChange);\n    this.onChange = onChange;\n    this.timerId = null;\n  }\n\n  Object.defineProperty(TimerModel.prototype, \"state\", {\n    get: function () {\n      return this.innerState.getState();\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(TimerModel.prototype, \"timeParts\", {\n    get: function () {\n      return this.getTimeParts(this.computeTime());\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  TimerModel.prototype.getTimeParts = function (time) {\n    return getTimeParts_1.default(time, this.lastUnit);\n  };\n\n  TimerModel.prototype.setTime = function (time) {\n    this.internalTime = now_1.default();\n    this.initialTime = time;\n    this.time = this.initialTime;\n    this.onChange(this.getTimeParts(this.time));\n  };\n\n  TimerModel.prototype.getTime = function () {\n    return this.time;\n  };\n\n  TimerModel.prototype.setLastUnit = function (lastUnit) {\n    if (this.innerState.isPlaying()) {\n      this.pause();\n      this.lastUnit = lastUnit;\n      this.resume(true);\n    } else {\n      this.lastUnit = lastUnit;\n    }\n  };\n\n  TimerModel.prototype.setTimeToUpdate = function (interval) {\n    if (this.innerState.isPlaying()) {\n      this.pause();\n      this.timeToUpdate = interval;\n      this.resume();\n    } else {\n      this.timeToUpdate = interval;\n    }\n  };\n\n  TimerModel.prototype.setDirection = function (direction) {\n    this.direction = direction;\n  };\n\n  TimerModel.prototype.setCheckpoints = function (checkpoints) {\n    this.checkpoints = checkpoints;\n  };\n\n  TimerModel.prototype.start = function () {\n    if (this.innerState.setPlaying()) {\n      this.setTimerInterval(true);\n    }\n  };\n\n  TimerModel.prototype.resume = function (callImmediately) {\n    if (callImmediately === void 0) {\n      callImmediately = false;\n    }\n\n    if (!this.innerState.isStopped() && this.innerState.setPlaying()) {\n      this.setTimerInterval(callImmediately);\n    }\n  };\n\n  TimerModel.prototype.pause = function () {\n    if (this.innerState.setPaused()) {\n      clearInterval(this.timerId);\n    }\n  };\n\n  TimerModel.prototype.stop = function () {\n    if (this.innerState.setStopped()) {\n      clearInterval(this.timerId);\n    }\n  };\n\n  TimerModel.prototype.reset = function () {\n    this.time = this.initialTime;\n    this.onChange(this.getTimeParts(this.time));\n  };\n\n  TimerModel.prototype.setTimerInterval = function (callImmediately) {\n    var _this = this;\n\n    if (callImmediately === void 0) {\n      callImmediately = false;\n    }\n\n    if (this.timerId) {\n      clearInterval(this.timerId);\n    }\n\n    this.internalTime = now_1.default();\n\n    var repeatedFunc = function () {\n      var oldTime = _this.time;\n\n      var updatedTime = _this.computeTime();\n\n      _this.onChange(_this.getTimeParts(updatedTime));\n\n      _this.checkpoints.map(function (_a) {\n        var time = _a.time,\n            callback = _a.callback;\n        var checkForForward = time > oldTime && time <= updatedTime;\n        var checkForBackward = time < oldTime && time >= updatedTime;\n        var checkIntersection = _this.direction === 'backward' ? checkForBackward : checkForForward;\n\n        if (checkIntersection) {\n          callback();\n        }\n      });\n    };\n\n    callImmediately && this.onChange(this.getTimeParts(this.time));\n    this.timerId = window.setInterval(repeatedFunc, this.timeToUpdate);\n  };\n\n  TimerModel.prototype.computeTime = function () {\n    if (this.innerState.isPlaying()) {\n      var currentInternalTime = now_1.default();\n      var delta = Math.abs(currentInternalTime - this.internalTime);\n\n      switch (this.direction) {\n        case 'forward':\n          this.time = this.time + delta;\n          this.internalTime = currentInternalTime;\n          return this.time;\n\n        case 'backward':\n          {\n            this.time = this.time - delta;\n            this.internalTime = currentInternalTime;\n\n            if (this.time < 0) {\n              this.stop();\n              return 0;\n            }\n\n            return this.time;\n          }\n\n        default:\n          return this.time;\n      }\n    }\n\n    return this.time;\n  };\n\n  return TimerModel;\n}();\n\nexports.TimerModel = TimerModel;","map":{"version":3,"mappings":"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","names":["_a","initialTime","direction","timeToUpdate","lastUnit","checkpoints","onChange","internalTime","now_1","time","innerState","TimerState_1","timerId","Object","TimerModel","getState","getTimeParts","computeTime","getTimeParts_1","isPlaying","pause","resume","interval","setPlaying","setTimerInterval","callImmediately","isStopped","setPaused","clearInterval","setStopped","repeatedFunc","oldTime","_this","updatedTime","map","callback","checkForForward","checkForBackward","checkIntersection","window","setInterval","currentInternalTime","delta","Math","abs","stop","exports"],"sourceRoot":"","sources":["../../../src/lib/models/TimerModel.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}